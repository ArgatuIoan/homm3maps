<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Hexagonal Grid Tool</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background: url('assets/fog.png') repeat; /* Set background image to repeat */
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent; /* Transparent background to show the repeating background image */
        }
        .controls {
            position: absolute;
            top: 0;
            right: 0;
            width: 250px; /* Make the rectangle thicker */
            height: 100%;
            background: url('assets/leather.png') repeat; /* Set leather texture as background */
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1; /* Ensure the controls are above the canvas */
        }
        .controls select, .controls button {
            margin-bottom: 10px;
            padding: 10px;
            font-size: 16px;
            width: 100%;
        }
        .status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <div class="controls">
        <select id="tileType" onchange="updateButtons()">
            <option value="terrain">Terrain</option>
            <option value="objects">Objects</option>
            <option value="level">Level</option>
        </select>

        <div id="terrainButtons">
            <button onclick="setAction('terrain', 'grass')">Grass</button>
            <button onclick="setAction('terrain', 'sand')">Sand</button>
        </div>

        <div id="objectsButtons" style="display:none;">
            <button onclick="setAction('building', 'castle')">Castle</button>
            <button onclick="setAction('building', 'necro')">Necropolis</button>
        </div>

        <div id="levelButtons" style="display:none;">
            <button onclick="setAction('level', '1')">Level 1</button>
            <button onclick="setAction('level', '2')">Level 2</button>
            <button onclick="setAction('level', '3')">Level 3</button>
        </div>
    </div>

    <script>
        let currentAction = 'terrain';
        let currentValue = 'grass'; // Default value for the brush
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let hexagons = [];
        const sideLength = 30; // Adjust size to fit more hexagons
        const xSpacing = 52; // Calculated from side length
        const ySpacing = 45; // Calculated from side length

        // Preload images
        const images = {
            grass: new Image(),
            sand: new Image(),
            water: new Image(),
            castle: new Image(),
            necro: new Image()
        };
        images.grass.src = 'assets/grass.png';
        images.sand.src = 'assets/sand.png';
        images.water.src = 'assets/water.png';
        images.castle.src = 'assets/castle.png';
        images.necro.src = 'assets/necro.png';

        window.onload = () => {
            resizeCanvas();
            loadImages();
        };
        window.onresize = resizeCanvas;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initializeHexagons();
            drawHexagonalGrid();
        }

        function initializeHexagons() {
            hexagons = [];
            const numRows = Math.floor(canvas.height / ySpacing);
            const numHexPerRow = Math.floor(canvas.width / xSpacing);

            for (let row = 0; row < numRows; row++) {
                for (let col = 0; col < numHexPerRow; col++) {
                    hexagons.push({
                        x: col * xSpacing + ((row % 2) * xSpacing / 2),
                        y: row * ySpacing,
                        terrain: 'none',
                        building: 'none',
                        level: '0'
                    });
                }
            }
        }

        function drawHexagonalGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hexagons.forEach(hex => drawHexagon(hex.x, hex.y, hex));
        }

        function drawHexagon(x, y, hex) {
            const points = [];
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI / 3 * i - Math.PI / 6;
                points.push({
                    x: x + sideLength * Math.cos(angle),
                    y: y + sideLength * Math.sin(angle)
                });
            }

            // Draw hexagon outline
            ctx.beginPath();
            points.forEach((point, index) => {
                if (index === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.closePath();
            ctx.strokeStyle = 'lightgray';
            ctx.stroke();

            // Draw image if terrain is set
            if (hex.terrain !== 'none') {
                const img = images[hex.terrain];
                ctx.save();
                ctx.clip();
                ctx.drawImage(img, x - sideLength, y - sideLength, sideLength * 2, sideLength * 2);
                ctx.restore();
            }

            // Draw building and level text
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '12px Arial';
            ctx.fillText(`${hex.building}, L${hex.level}`, x, y);
        }

        canvas.addEventListener('click', function(event) {
            const rect = canvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;

            hexagons.forEach(hex => {
                const distance = Math.sqrt((clickX - hex.x) ** 2 + (clickY - hex.y) ** 2);
                if (distance < sideLength) {
                    hex[currentAction] = currentValue;
                    drawHexagonalGrid();
                }
            });
        });

        function setAction(action, value) {
            currentAction = action;
            currentValue = value;
            document.getElementById('status').innerText = `Selected ${action} brush with value: ${value}`;
        }

        function loadImages() {
            const promises = [];
            for (const key in images) {
                const img = images[key];
                promises.push(new Promise((resolve) => {
                    img.onload = resolve;
                }));
            }
            Promise.all(promises).then(drawHexagonalGrid);
        }

        function updateButtons() {
            const tileType = document.getElementById('tileType').value;
            document.getElementById('terrainButtons').style.display = (tileType === 'terrain') ? 'block' : 'none';
            document.getElementById('objectsButtons').style.display = (tileType === 'objects') ? 'block' : 'none';
            document.getElementById('levelButtons').style.display = (tileType === 'level') ? 'block' : 'none';
        }
    </script>
</body>
</html>
